<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv='X-UA-Compatible' content='IE=edge' />
    <link rel='stylesheet' href='style/main.css' />
    <script src="https://www.WebRTC-Experiment.com/RecordRTC.js"></script>
    <title>BAR„ÇÆ„Ç≥„Å£„ÅΩ„ÅÑONLINE</title>
</head>

<body>
    <div id="vue-app" v-cloak>
        <div id="login-page" v-if="!loggedIn">
            <h1>{{ $t("ui.site_name") }}</h1>
            <form>
                <label>User Name:</label> <input type="text" v-model="username" />
                <div id="character-selection">
                    <input type="radio" id="giko-selection" value="giko" v-model="characterId">
                    <label for="giko-selection">
                        <img src="characters/giko/front-standing.png" />
                    </label>
                    <input type="radio" id="naito-selection" value="naito" v-model="characterId">
                    <label for="naito-selection">
                        <img src="characters/naito/front-standing.png" />
                    </label>
                </div>
                <button v-on:click="login" :disabled="isLoggingIn">Login</button>
            </form>
            <div id="change-log">
                <pre>{{ $t("change_log") }}</pre>
            </div>
        </div>
        <div id="stage" v-if="loggedIn">
            <h2 class="big-red-alert" v-if="connectionLost">
                {{ $t("msg.connection_lost") }}
            </h2>
            <h2 class="big-red-alert" v-if="steppingOnPortalToNonAvailableRoom">
                {{ $t("msg.room_unavailable") }}
            </h2>
            <div id="canvas-container">
                <canvas id="room-canvas" width="721px" height="511px" tabindex="1"
                    v-on:keydown="handleCanvasKeydown($event)"></canvas>
                <div id="infobox-container">
                    <div id="infobox" v-show="isInfoboxVisible">
                        <div id="infobox-area" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_area") }}</div>
                            <div class="infobox-value">{{ $t("ui.infobox_value_area") }}</div>
                        </div>
                        <div id="infobox-roomname" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_room") }}</div>
                            <div class="infobox-value">{{ $t("room."+roomid) }}</div>
                        </div>
                        <div id="infobox-username" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_user_name") }}</div>
                            <div class="infobox-value">{{ myUserID && users && users[myUserID] ? users[myUserID].name :
                                '-' }}</div>
                        </div>
                        <div id="infobox-usercount" class="infobox-line">
                            <div class="infobox-title">{{ $t("ui.infobox_label_user_count") }}</div>
                            <div class="infobox-value">{{ serverStats.userCount }}</div>
                        </div>
                    </div>
                    <button id="infobox-button" class="canvas-button-top-right" v-on:click="toggleInfobox"
                        tabindex="-1"></button>
                </div>
            </div>
            <div id="toolbar">
                {{ $t("ui.label_input") }} <input id="input-textbox" type="text"
                    v-on:keydown="handleMessageInputKeydown($event)" tabindex="2"></input>
                <button id="send-button" v-on:click="sendMessageToServer" tabindex="3">{{ $t("ui.button_send")
                    }}</button>
                <button id="toggle-sound" v-on:click="toggleSound">
                    {{ $t(isSoundEnabled ? "ui.button_toggle_sound_on" : "ui.button_toggle_sound_off") }}
                </button>
                <button id="btn-move-left" v-on:click="sendNewPositionToServer('left')">‚Üê</button>
                <button id="btn-move-up" v-on:click="sendNewPositionToServer('up')">‚Üë</button>
                <button id="btn-move-down" v-on:click="sendNewPositionToServer('down')">‚Üì</button>
                <button id="btn-move-right" v-on:click="sendNewPositionToServer('right')">‚Üí</button>

                <button v-on:click="switchLanguage">{{ $t("ui.button_switch_language") }}</button>
            </div>
            {{ $t("ui.label_log") }}
            <div id="chatLog">
            </div>


            <div id="video-streams">
                <div v-for="(streamSlot, index) in this.currentRoom.streams">
                    <hr v-if="index != 0" />
                    <div v-if="streamSlot.isActive">
                        {{ $t("ui.label_streamer") }} {{ users[streamSlot.userId].name }}
                    </div>
                    <video :id="'local-video-' + index"
                        v-show="streamSlot.isActive && streamSlot.withVideo && index == streamSlotIdInWhichIWantToStream"
                        autoplay muted></video>
                    <video :id="'received-video-' + index"
                        v-show="takenStreams[index] && streamSlot.withVideo && index != streamSlotIdInWhichIWantToStream"
                        autoplay></video>

                    <div v-show="streamSlot.isActive && index != streamSlotIdInWhichIWantToStream">
                        <label for="volume">{{ $t("ui.volume") }}</label>
                        <input type="range" :id="'volume-' + index" v-on:change="changeVolume(index)" name="volume"
                            min="0" max="1" step="0.01" value="1">
                    </div>
                    
                    <div v-if="!streamSlot.isActive && !iAmStreaming && !wantToStream">
                        {{ $t("ui.label_stream_start") }}
                        <button class="start-streaming-button" :id="'start-video-streaming-button-' + index"
                            v-on:click="wantToStartStreaming(index, true, false)">üìπ</button>
                        <button class="start-streaming-button" :id="'start-sound-streaming-button-' + index"
                            v-on:click="wantToStartStreaming(index, false, true)">üé§</button>
                        <button class="start-streaming-button" :id="'start-video-sound-streaming-button-' + index"
                            v-on:click="wantToStartStreaming(index, true, true)">üìπ ‚ûï üé§</button>
                    </div>
                    <button :id="'stop-streaming-button-' + index"
                        v-if="iAmStreaming && streamSlotIdInWhichIWantToStream == index" v-on:click="stopStreaming">
                        {{ $t("ui.button_stream_stop") }}
                    </button>
                    
                    <button :id="'get-stream-button-' + index"
                        v-if="streamSlot.isReady && !takenStreams[index] && streamSlot.userId != myUserID && !wantToStream"
                        v-on:click="wantToGetStream(index)">
                        {{ $t("ui.button_stream_get") }}
                    </button>
                    <button :id="'stop-getting-stream-button-' + index"
                        v-if="streamSlot.isReady && takenStreams[index] && streamSlot.userId != myUserID && !wantToStream"
                        v-on:click="wantToStopGettingStream(index)">
                        {{ $t("ui.button_stream_stop_getting") }}
                    </button>
                </div>
            </div>
            <div id="rula-menu" v-if="isRulaPopupOpen">
                <button v-for="roomId in rulableRooms" v-on:click="rula(roomId)">{{ $t("room." + roomId) }}</button>
                <button v-on:click="cancelRula()" id="cancel-rula-button">{{ $t("ui.cancel")}}</button>
            </div>

            <audio id="message-sound" src="message.mp3"></audio>
            <audio id="login-sound" src="login.mp3"></audio>
            <audio id="connection-lost-sound" src="connection-lost.mp3"></audio>

        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
    <script src="https://unpkg.com/vue-i18n/dist/vue-i18n.js"></script>
    <script src='third/jquery.js'></script>
    <script src="/socket.io/socket.io.js"></script>
    <script type="module" src='scripts/main.js'></script>

    <script>

    </script>
</body>

</html>
